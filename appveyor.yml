version: 1.0.{build}

image: Visual Studio 2019

clone_folder: c:\src\github.com\runner-mei\GoBatis\cmd\gobatis

environment:
  GOPATH: c:\
  GO111MODULE: on
  SQLINSTANCE: SQL2017
  HOST: localhost
  SQLUSER: sa
  SQLPASSWORD: Password12!
  DATABASE: test

services:
  - mssql2017

before_test:
  - dir c:\
  - echo https://go.dev/dl/go1.17.6.windows-amd64.zip
  - go version
  - go get golang.org/x/tools/cmd/goimports
  - go install golang.org/x/tools/cmd/goimports
  - go get github.com/aryann/difflib
  - go get github.com/grsmv/inflect
  - go get github.com/Knetic/govaluate
  - go get github.com/lib/pq
  - go get github.com/go-sql-driver/mysql
  - go get github.com/denisenkom/go-mssqldb
  - go get github.com/mattn/goveralls/tester
  # setup SQL Server 
  - ps: |
      $instanceName = $env:SQLINSTANCE
      Start-Service "MSSQL`$$instanceName"
      Start-Service "SQLBrowser"
  - sqlcmd -S "(local)\%SQLINSTANCE%" -Q "Use [master]; CREATE DATABASE test COLLATE Chinese_PRC_CI_AS"

test_script:
  - set PATH=c:\go\bin;%PATH%
  - cd c:\src\github.com\runner-mei\GoBatis\cmd\gobatis
  - go install
  - cd ../..
  - dir
  - go install
  - go generate ./...
  - del gentest\fail\interface.gobatis.go
  - go test -v -dbDrv=mssql    "-dbURL=sqlserver://%SQLUSER%:%SQLPASSWORD%@%HOST%/%SQLINSTANCE%?database=%DATABASE%&connection+timeout=30" ./...

build: off 